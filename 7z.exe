7z.exe
 #banker#ramnit
 2 mẫu còn lại 7zFM và 7zG cũng thực hiện hành vi tương tự 7z.exe
 7z sử dụng cmd để thực hiện lệnh còn 2 mẫu còn lại có GUI
---------------------------------------------------------------------------------------
File
      Tạo file    C:\Users\<User>\Desktop\malware_tech\ramnit\7zmgr.exe
---------------------------------------------------------------------------------------
Tạo Process mới      
      C:\Users\<User>\Desktop\malware_tech\ramnit\7zmgr.exe
---------------------------------------------------------------------------------------   
    -> 7z.exe giả mạo phần mềm 7z với các tính năng giống như 7z thật
    -> Sau do tạo và thực thi file C:\Users\<User>\Desktop\malware_tech\ramnit\7zmgr.exe


7zmgr.exe
---------------------------------------------------------------------------------------
File
      Tạo và ghi vào file	C:\Users\<User>\AppData\Local\Temp\~TMF99C.tmp
---------------------------------------------------------------------------------------
Registry
      RegQueryValue	HKLM\System\CurrentControlSet\Control\Terminal Server\TSUserEnabled	SUCCESS	Type: REG_DWORD, Length: 4, Data: 0
      RegQueryValue	HKCR\http\shell\open\command\(Default)	SUCCESS	Type: REG_SZ, Length: 128, Data: "C:\Program Files (x86)\Internet Explorer\iexplore.exe" -nohome
      RegQueryValue     HKLM\HARDWARE\DESCRIPTION\SYSTEM\SYSTEMBIOSVERSION
      RegQueryValue     HKLM\SYSTEM\CONTROLSET001\CONTROL\COMPUTERNAME\ACTIVECOMPUTERNAME\COMPUTERNAME
---------------------------------------------------------------------------------------
Tạo Process mới      
      
--------------------------------------------------------------------------------------- 
Network
      Domain: stromoliks.com                    Address:  72.14.182.233   
---------------------------------------------------------------------------------------   
      khi chạy, mgr.exe sẽ copy ntdll.dll và kernel32.dll ra temp files và đặt chúng vao duong dan
      C:\Users\<User>\AppData\Local\Temp\
      Ten temp file co dang ~TMF99C.tmp
      
      Tiep theo no se dieu chinh quyen cua minh de co quyen SeDebugPrivilege bang cach goi ham AdjustTokenPrivileges
      Tiep theo malware se thay doi dia chi cua ntdll.ZwWriteVirtualMemory de no tra ve dia chi trong vung nho cua malware
      -> Hook Injection 
      Sau khi hook ZwWriteVirtualMemory duoc tao thanh cong, malware se goi CreateProcess voi iexplore.exe (trinh duyet mac dinh)
      CreateProcess trong kernel32.dll cuoi cung se goi den WriteVirtualMemory trong ntdll.dll
      -> hook duoc kich hoat va no thuc hien qua trinh injection vao process
      doan code duoc injection vao process iexplore.exe duoc luu trong binary cua 7zmgr.exe tai dia chi 309f va co do dai 1fc00
      
      malware tiem vao process iexplore.exe doan code co tac dung:
      - tao mutex:
        mutex duoc tinh bang thuat toan voi tham so la serial volume information
        mutex co dang {%08X-%04X-%04X-%04X-%08X%04X}
        
      - tao file C:\Users\<User>\AppData\Roaming\Microsoft\windows\Start menu\Programs\Startup\cqfqowuq.exe 
      - tao ra file dmlconf.dat
      - chay script:
      - tao ra nhieu thread
       + thread 1: Ket noi den google.com va bing.com
       + thread 2:
         lang nghe ket noi den tai socket 1
         accept ket noi den
         nhan packet gui den, luu packet vao mot buffer, packet co dang 1 chuoi so (do dai tu 1 -> 5 chu so)
         gui di packet co dang 1 chu so sau moi lan nhan duoc packet
         nhan them vai packet duoi sang chuoi so de nhan lenh, chia lam 2 lenh (switch-case)
            1. connect den 1 dia chi bang socket 2, thuc hien truyen packet tu socket 1 -> socket 2
            2. listen va accept ket noi den tren socket 3, truyen packet tu socket 3 -> socket 1
         tunnel?
        + thread 3:
         gui 1 requests GET co format co san trong binary:
         requests co 2 tham so GET va HOST duoc giai ma trong qua trinh thuc thi
         gui di packet co chua cac thong tin co ban ve may tinh
         nhan tiep cac packet chua lenh:
           - tao thread moi co chuc nang nhu thread 2
           - tao thread moi:
              nhan lenh tu HOST duoi dang 1 chuoi string
              phan giai chuoi string thanh cac lenh bang 1 thuat toan X va thuc hien cac lenh do:
               - gui requests GET den HOST, nhan va luu noi dung vao file, chay file do
               - hien thi mot hinh anh or cua so len man hinh chinh
               - disable WASAntidot, thuc hien lenh shlwapi.dll.SHDeleteKeyA voi tham so la System,Hardware,Software
                goi lenh ntdll.NtShutdownSystem(2)
               - nhan va luu noi dung vao file, chay file do
       + thread 4:
         drop file mgr.exe vao rat nhieu file trong o C. Hang nghin file
       + thread 5:
         Chay 1 script co san trong binary
         3 tham so deu giong nhau va duoc giai ma bang thuat toan trong qua trinh chay
         thuc hien cac query lien quan de registry
         SYSTEM/CurrentControlSet/Enum/USBSTOR
         
           
            
            
      
---------------------------------------------------------------------------------------        
7z.dll
Tạo file
    C:\Documents and Settings\<User>\Start Menu\Programs\Startup\maswtjoy.exe
    C:\Program Files\etbkjgfi\maswtjoy.exe
    System\gen_hostmgr.exe 
    System\rundll32mgr.exe
    C:\ProgramFiles\Internet Explorer\dmlconf.dat

Sửa file
    c:\contacts.html
    c:\Inetpub\wwwroot\index.html
    ProgramFiles\Common Files\designer\MSHTMPGR.DLL
    ProgramFiles\Common Files\System\ado\MDACReadme.htm
    ProgramFiles\Common Files\System\Ole DB\MSDAIPP.DLL
    ProgramFiles\MSN\MSNCoreFiles\OOBE\obelog.dll
    ProgramFiles\MSN\MSNCoreFiles\OOBE\obemetal.dll
    ProgramFiles\MSN\MSNCoreFiles\OOBE\obepopc.dll
    ProgramFiles\MSN\MSNIA\custdial.dll
    ProgramFiles\MSN\MSNIA\msniasvc.exe
    ProgramFiles\MSN\MSNIA\prestp.exe
    ProgramFiles\MSN\MsnInstaller\iasvcstb.dll
    ProgramFiles\MSN\MsnInstaller\msdbxi.dll
    ProgramFiles\MSN\MsnInstaller\msninst.dll
    ProgramFiles\MSN\MsnInstaller\msninst.exe
    ProgramFiles\MSN\MsnInstaller\msnsign.dll
    ProgramFiles\NetMeeting\netmeet.htm

Tạo process
    gen_hostmgr.exe	
    rundll32mgr.exe

      
    



      
      

